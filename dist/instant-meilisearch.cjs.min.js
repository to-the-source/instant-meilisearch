"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("meilisearch"),e=function(){return(e=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function n(t,e,n,r){return new(n||(n=Promise))((function(i,a){function o(t){try{s(r.next(t))}catch(t){a(t)}}function u(t){try{s(r.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}s((r=r.apply(t,e||[])).next())}))}function r(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}function i(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t}function a(t){return"string"==typeof t||t instanceof String}function o(t){return t.replace(/:(.*)/i,'="$1"')}var u=function(t){var e=t.match(/([^=]*)="?([^\\"]*)"?$/);return e?(e[0],[{filterName:e[1],value:e[2]}]):[]};function s(t){var n=function(t){return"string"==typeof t?u(t):Array.isArray(t)?t.map((function(t){return Array.isArray(t)?t.map((function(t){return u(t)})):u(t)})).flat(2):[]}(t);return n.filter((function(t){return void 0!==t})).reduce((function(t,n){var r,a=n.filterName,o=n.value,u=t[a]||[];return t=e(e({},t),((r={})[a]=i(i([],u),[o]),r))}),{})}function c(t,n){return t.keepZeroFacets?(r=t.defaultFacetDistribution,Object.keys(r).reduce((function(t,n){var i,a=Object.keys(r[n]);return e(e({},t),((i={})[n]=a,i))}),{})):s(null==n?void 0:n.filter);var r}function l(t){return{searchResponse:function(e,i,a){return n(this,void 0,void 0,(function(){var n,o,u,s;return r(this,(function(r){switch(r.label){case 0:return n=t.formatKey([i,e.indexUid,e.query]),(o=t.getEntry(n))?[2,o]:(u=c(e,i),[4,a.index(e.indexUid).search(e.query,i)]);case 1:return(s=r.sent()).facetsDistribution=function(t,e){if(e=e||{},t&&Object.keys(t).length>0)for(var n in t){e[n]||(e[n]={});for(var r=0,i=t[n];r<i.length;r++){var a=i[r];Object.keys(e[n]).includes(a)||(e[n][a]=0)}}return e}(u,s.facetsDistribution),t.setEntry(n,s),[2,s]}}))}))}}}function f(t){return 180*t/Math.PI}function h(t){return t*Math.PI/180}function d(t){if(t){var e,n,r=t.insideBoundingBox,i=t.aroundLatLng,a=t.aroundRadius,o=t.minimumAroundRadius;if(i&&(e=i),null==a&&null==o||(n=null!=a?a:o),r&&"string"==typeof r){var u=r.split(","),s=u[0],c=u[1],l=u[2],d=u[3],p=[parseFloat(s),parseFloat(c),parseFloat(l),parseFloat(d)],g=p[0],v=p[1],y=p[2],m=p[3];n=function(t,e,n,r){var i=t*Math.PI/180,a=n*Math.PI/180,o=(n-t)*Math.PI/180,u=(r-e)*Math.PI/180,s=Math.sin(o/2)*Math.sin(o/2)+Math.cos(i)*Math.cos(a)*Math.sin(u/2)*Math.sin(u/2);return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371e3}(g,v,y,m)/2,e=function(t,e,n,r){t=h(t),e=h(e);var i=Math.cos(t)*Math.cos(e),a=Math.cos(t)*Math.sin(e),o=Math.sin(t);n=h(n),r=h(r);var u=i+Math.cos(n)*Math.cos(r),s=a+Math.cos(n)*Math.sin(r),c=o+Math.sin(n),l=Math.sqrt(u*u+s*s),d=Math.atan2(s,u),p=Math.atan2(c,l);return e<r||e>r&&e>Math.PI&&r<-Math.PI?(p+=Math.PI,d+=Math.PI):(p=f(p),d=f(d)),Math.abs(u)<Math.pow(10,-9)&&Math.abs(s)<Math.pow(10,-9)&&Math.abs(c)<Math.pow(10,-9)&&(p=0,d=0),"".concat(p,",").concat(d)}(g,v,y,m)}if(null!=e&&null!=n){var b=e.split(","),M=b[0],P=b[1];return M=Number.parseFloat(M).toFixed(5),P=Number.parseFloat(P).toFixed(5),{filter:"_geoRadius(".concat(M,", ").concat(P,", ").concat(n,")")}}}}function p(t){return"string"==typeof t?o(t):Array.isArray(t)?t.map((function(t){return Array.isArray(t)?t.map((function(t){return o(t)})).filter((function(t){return t})):o(t)})).filter((function(t){return t})):[]}function g(t){return""===t?[]:"string"==typeof t?[t]:t}function v(t,e,n){return function(t,e,n){var r=n.trim(),a=g(t),o=g(e);return i(i(i([],a),o),[r]).filter((function(t){return Array.isArray(t)?t.length:t}))}(p(n||[]),p(e||[]),t||"")}function y(t){var e={},n=null==t?void 0:t.facets;(null==n?void 0:n.length)&&(e.facetsDistribution=n);var r=null==t?void 0:t.attributesToSnippet;r&&(e.attributesToCrop=r);var i=null==t?void 0:t.attributesToRetrieve;i&&(e.attributesToRetrieve=i);var a=v(null==t?void 0:t.filters,null==t?void 0:t.numericFilters,null==t?void 0:t.facetFilters);a.length&&(e.filter=a),e.attributesToHighlight=(null==t?void 0:t.attributesToHighlight)||["*"];var o=t.placeholderSearch,u=t.query,s=t.paginationTotalHits;e.limit=!o&&""===u||0===s?0:s;var c=t.sort;(null==c?void 0:c.length)&&(e.sort=[c]);var l=d(function(t){var e={},n=t.aroundLatLng,r=t.aroundLatLngViaIP,i=t.aroundRadius,a=t.aroundPrecision,o=t.minimumAroundRadius,u=t.insideBoundingBox,s=t.insidePolygon;return n&&(e.aroundLatLng=n),r&&console.warn("instant-meilisearch: `aroundLatLngViaIP` is not supported."),i&&(e.aroundRadius=i),a&&console.warn("instant-meilisearch: `aroundPrecision` is not supported.\n    See this discussion to track its implementation https://github.com/meilisearch/product/discussions/264"),o&&(e.minimumAroundRadius=o),u&&(e.insideBoundingBox=u),s&&console.warn("instant-meilisearch: `insidePolygon` is not implented in instant-meilisearch."),e}(t));return(null==l?void 0:l.filter)&&(e.filter?e.filter.unshift(l.filter):e.filter=[l.filter]),e}function m(t,e,n){return"string"==typeof t?function(t,e,n){return void 0===e&&(e="__ais-highlight__"),void 0===n&&(n="__/ais-highlight__"),(a(t)?t:JSON.stringify(t)).replace(/<em>/g,e).replace(/<\/em>/g,n)}(t,e,n):void 0===t?JSON.stringify(null):JSON.stringify(t)}function b(t,e,n){return t._formatted?Object.keys(t._formatted).reduce((function(r,i){var a=t._formatted[i];return r[i]=function(t,e,n){return Array.isArray(t)?t.map((function(t){return{value:m(t,e,n)}})):{value:m(t,e,n)}}(a,e,n),r}),{}):t._formatted}function M(t,e,n){var r,i=e;return a(e)&&t.toString().length>(r=e,r.replace(/<em>/g,"").replace(/<\/em>/g,"")).length&&(e[0]===e[0].toLowerCase()&&!1===e.startsWith("<em>")&&(i="".concat(n).concat(e.trim())),!1==!!e.match(/[.!?]$/)&&(i="".concat(e.trim()).concat(n))),i}function P(t,e,n){return n&&"string"==typeof e?Array.isArray(t)?t.map((function(t){return M(t,e,n)})):M(t,e,n):e}function w(t,e){var n=null==e?void 0:e.attributesToSnippet,r=null==e?void 0:e.snippetEllipsisText,i=null==e?void 0:e.highlightPreTag,a=null==e?void 0:e.highlightPostTag;return t._formatted?{_highlightResult:b(t,i,a),_snippetResult:b(function(t,e,n){var r=t._formatted,i=t._formatted;if(void 0===e)return t;var a=e.map((function(t){return t.split(":")[0]}));if(a.includes("*"))for(var o in r)i[o]=P(t[o],r[o],n);else for(var u=0,s=a;u<s.length;u++)i[o=s[u]]=P(t[o],r[o],n);return t._formatted=i,t}(t,n,r),i,a)}:{}}function _(t,n,r){var i=n.primaryKey,a=r.hitsPerPage,o=function(t,e,n){if(n<0)throw new TypeError('Value too small for "hitsPerPage" parameter, expected integer between 0 and 9223372036854775807');var r=e*n;return t.slice(r,r+n)}(t,r.page,a).map((function(t){if(Object.keys(t).length>0){t._formatted,t._matchesInfo;var r=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}(t,["_formatted","_matchesInfo"]);return e(e(e({},r),w(t,n)),i&&{objectID:t[i]})}return t}));return o=function(t){for(var e=0;e<t.length;e++)t[e]._geo&&(t[e]._geoloc={lat:t[e]._geo.lat,lng:t[e]._geo.lng},t[e].objectID="".concat(e+1e6*Math.random()),delete t[e]._geo);return t}(o)}function x(t,n){var r={},i=t.facetsDistribution,a=null==t?void 0:t.exhaustiveFacetsCount;a&&(r.exhaustiveFacetsCount=a);var o,u,s=function(t){return{paginationTotalHits:t.paginationTotalHits||200,hitsPerPage:void 0===t.hitsPerPage?20:t.hitsPerPage,page:(null==t?void 0:t.page)||0}}(n),c=(o=t.hits.length,(u=s.hitsPerPage)>0?Math.ceil(o/u):0),l=_(t.hits,n,s),f=t.exhaustiveNbHits,h=t.nbHits,d=t.processingTimeMs,p=t.query,g=s.hitsPerPage,v=s.page;return{results:[e({index:n.indexUid,hitsPerPage:g,page:v,facets:i,nbPages:c,exhaustiveNbHits:f,nbHits:h,processingTimeMS:d,query:p,hits:l,params:""},r)]}}function O(t){void 0===t&&(t={});var e=t;return{getEntry:function(t){if(e[t])try{return JSON.parse(e[t])}catch(n){return e[t]}},formatKey:function(t){return t.reduce((function(t,e){return t+JSON.stringify(e)}),"")},setEntry:function(t,n){e[t]=JSON.stringify(n)}}}exports.instantMeiliSearch=function(i,a,o){void 0===a&&(a=""),void 0===o&&(o={});var u=l(O()),s={};return{MeiliSearchClient:new t.MeiliSearch({host:i,headers:{"X-MEILI-API-KEY":a}}),search:function(t){return n(this,void 0,void 0,(function(){var n,i,a,c,l;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),n=t[0],i=function(t,n,r){var i=t.indexName.split(":"),a=i[0],o=i.slice(1),u=t.params;return e(e(e({},n),u),{sort:o.join(":")||"",indexUid:a,defaultFacetDistribution:r,placeholderSearch:!n.placeholderSearch,paginationTotalHits:null!=n.paginationTotalHits?n.paginationTotalHits:200,keepZeroFacets:!!n.keepZeroFacets})}(n,o,s),a=y(i),[4,u.searchResponse(i,a,this.MeiliSearchClient)];case 1:return c=r.sent(),s=function(t,e){return""===e.query&&0===Object.keys(t).length?e.facetsDistribution:t}(s,c),[2,x(c,i)];case 2:throw l=r.sent(),console.error(l),new Error(l);case 3:return[2]}}))}))},searchForFacetValues:function(t){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,e){e(new Error("SearchForFacetValues is not compatible with Meilisearch")),t([])}))];case 1:return[2,t.sent()]}}))}))}}};
//# sourceMappingURL=instant-meilisearch.cjs.min.js.map
